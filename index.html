<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Horas de trabajo</title>
<link rel="manifest" href="manifest.json">
<style>
  body { font-family: sans-serif; margin: 0; padding: 0; }
  h1 { text-align: center; }
  .grid {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    border: 1px solid #ccc;
  }
  .grid div {
    border: 1px solid #ccc;
    width: 50px; height: 50px;
    position: relative;
    cursor: pointer;
  }
  .header { background: #eee; font-weight: bold; text-align: center; }
  .color-orange { background-color: orange; }
  .color-blue { background-color: lightblue; }
  .color-purple { background-color: violet; }
  .half {
    background: linear-gradient(to top left, transparent 49%, currentColor 51%);
  }
  #summary { padding: 10px; }
</style>
</head>
<body>
<h1>Horas de trabajo</h1>
<div class="grid" id="grid"></div>
<div id="summary"></div>

<script>
const days = ["", "Lun", "Mar", "Mié", "Jue", "Vie", "Sáb", "Dom"];
const startHour = 5;
const endHour = 22;
const colors = ["", "color-orange", "color-blue", "color-purple"];
const grid = document.getElementById("grid");
const summary = document.getElementById("summary");
let data = JSON.parse(localStorage.getItem("workHours") || "{}");

function buildGrid() {
  // Encabezados
  days.forEach(d => {
    const cell = document.createElement("div");
    cell.className = "header";
    cell.innerText = d;
    grid.appendChild(cell);
  });

  for (let hour = startHour; hour <= endHour; hour++) {
    // Hora en primera columna
    const hourCell = document.createElement("div");
    hourCell.className = "header";
    hourCell.innerText = hour+":00";
    grid.appendChild(hourCell);

    // Días
    for (let day = 1; day <= 7; day++) {
      const cell = document.createElement("div");
      const key = `${day}-${hour}`;
      if (data[key]) cell.className = data[key];
      cell.addEventListener("click", () => {
        let current = colors.indexOf(data[key] || "");
        current = (current + 1) % colors.length;
        data[key] = colors[current];
        if (!colors[current]) delete data[key];
        cell.className = colors[current];
        saveData();
        updateSummary();
      });
      cell.addEventListener("contextmenu", (e) => {
        e.preventDefault();
        if (data[key] && !data[key].includes("half")) {
          data[key] += " half";
        } else if (data[key]) {
          data[key] = data[key].replace(" half", "");
        }
        cell.className = data[key] || "";
        saveData();
        updateSummary();
      });
      grid.appendChild(cell);
    }
  }
}

function saveData() {
  localStorage.setItem("workHours", JSON.stringify(data));
}

function updateSummary() {
  let counts = {orange: 0, blue: 0, purple: 0};
  Object.values(data).forEach(val => {
    let factor = val.includes("half") ? 0.5 : 1;
    if (val.includes("orange")) counts.orange += factor;
    if (val.includes("blue")) counts.blue += factor;
    if (val.includes("purple")) counts.purple += factor;
  });
  summary.innerHTML = `
    Naranja (Docencia): ${counts.orange} h<br>
    Azul (Investigación): ${counts.blue} h<br>
    Morado (Administrativo): ${counts.purple} h
  `;
}

buildGrid();
updateSummary();
</script>
</body>
</html>